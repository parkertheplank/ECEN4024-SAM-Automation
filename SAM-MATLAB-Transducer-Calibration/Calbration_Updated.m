%SAM Sensor Calibration

clear;
close all;


adc = [4.957,4.878,4.811,4.721,4.645,4.559,4.485,4.418,4.344,4.282,4.215,4.138,4.072,4.064,4.052,4.038,4.026,4.016,4.01,4.008,4.006,4.005,4.002,3.997,3.989,3.98,3.971,3.952,3.937,3.874,3.802,3.734,3.672,3.607,3.538,3.467,3.405,3.337,3.273,3.209,3.148,3.077,3.068,3.057,3.039,3.03,3.023,3.017,3.01,3.008,3.005,3,2.994,2.99,2.981,2.972,2.964,2.951,2.943,2.883,2.811,2.742,2.668,2.603,2.539,2.468,2.405,2.334,2.273,2.204,2.135,2.078,2.037,2.03,2.019,2.007,2,1.993,1.983,1.977,1.971,1.968,1.96,1.953,1.943,1.938,1.875,1.8,1.738,1.669,1.599,1.538,1.471,1.401,1.337,1.273,1.2,1.137,1.07,0.997];

psi = [59.25,58.07,57.07,55.73,54.6,53.31,52.2,51.2,50.08,49.16,48.15,47,46.01,45.9,45.72,45.51,45.33,45.18,45.1,45.06,45.02,45.01,44.97,44.88,44.77,44.63,44.5,44.22,43.99,43.04,41.97,40.94,40.02,39.05,38.01,36.95,36.02,34.99,34.03,33.07,32.15,31.09,30.95,30.78,30.51,30.37,30.28,30.18,30.08,30.05,30,29.93,29.84,29.78,29.64,29.51,29.39,29.21,29.07,28.18,27.1,26.07,24.98,23.99,23.04,21.98,21.05,19.98,19.06,18.03,17,16.11,15.53,15.42,15.25,15.08,14.97,14.86,14.71,14.63,14.54,14.49,14.37,14.27,14.12,14.04,13.01,11.97,11.04,10.01,8.96,8.04,7.04,5.99,5.02,4.06,2.97,2.01,1.01,-0.08];




adc_14 = [4.957,4.878,4.811,4.721,4.645,4.559,4.485,4.418,4.344,4.282,4.215,4.138,4.072,4.064,4.052,4.038,4.026,4.016,4.01,4.008,4.006,4.005,4.002,3.997,3.989,3.98,3.971,3.952,3.937,3.874,3.802,3.734,3.672];
psi_14 = [59.25,58.07,57.07,55.73,54.6,53.31,52.2,51.2,50.08,49.16,48.15,47,46.01,45.9,45.72,45.51,45.33,45.18,45.1,45.06,45.02,45.01,44.97,44.88,44.77,44.63,44.5,44.22,43.99,43.04,41.97,40.94,40.02];

eq_14 = polyfit(adc_14,psi_14,1);



adc_30 = [3.607,3.538,3.467,3.405,3.337,3.273,3.209,3.148,3.077,3.068,3.057,3.039,3.03,3.023,3.017,3.01,3.008,3.005,3,2.994,2.99,2.981,2.972,2.964,2.951,2.943,2.883,2.811,2.742,2.668,2.603,2.539,2.468];

psi_30 = [39.05,38.01,36.95,36.02,34.99,34.03,33.07,32.15,31.09,30.95,30.78,30.51,30.37,30.28,30.18,30.08,30.05,30,29.93,29.84,29.78,29.64,29.51,29.39,29.21,29.07,28.18,27.1,26.07,24.98,23.99,23.04,21.98];

eq_30 = polyfit(adc_30,psi_30,1);




psi_45 = [21.05,19.98,19.06,18.03,17,16.11,15.53,15.42,15.25,15.08,14.97,14.86,14.71,14.63,14.54,14.49,14.37,14.27,14.12,14.04,13.01,11.97,11.04,10.01,8.96,8.04,7.04,5.99,5.02,4.06,2.97,2.01,1.01,-0.08];


adc_45 = [2.405,2.334,2.273,2.204,2.135,2.078,2.037,2.03,2.019,2.007,2,1.993,1.983,1.977,1.971,1.968,1.96,1.953,1.943,1.938,1.875,1.8,1.738,1.669,1.599,1.538,1.471,1.401,1.337,1.273,1.2,1.137,1.07,0.997];

eq_45 = polyfit(adc_45,psi_45,1);


plot(adc_14, psi_14, 'o');
hold on;
plot(adc_14, psi_14, 'r');

figure;

plot(adc_30, psi_30, 'o');
hold on;
plot(adc_30, psi_30, 'r');

figure;

plot(adc_45, psi_45, 'o');
hold on;
plot(adc_45, psi_45, 'r');

figure;






eq = polyfit(adc,psi,1);

plot(adc, psi, 'o');
hold on;
plot(adc, psi, 'r');

psi_fit = polyval(eq, adc);

psiresid = psi - psi_fit;

SSresid = sum(psiresid.^2);

SStotal = (length(psi)-1) * var(psi);

rsq = 1 - SSresid/SStotal;












